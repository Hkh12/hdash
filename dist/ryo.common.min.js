"use strict";function error$1(e,t){var n="[ryo"+(t?"":" error")+"] "+e;if(!t)throw new Error(n);console.warn(n)}var alld=[];function register(e,t){e=e.toLowerCase(),/^[a-z]+(?:-?\*)?$/.test(e)||error$1('invalid directive name "'+e+'"');var n=new RegExp(e.replace(/\*$/,"([a-z]+)")+"$"),r={name:e,expression:n,fn:t};alld.push(r)}function exec(e,t,n){for(var r=null,i=0;i<length;i++)if(alld[i].expression.test(e.toLowerCase())){r=alld[i];break}null===r&&error$1('directive "'+e+'" not found');var o=e.match(r.expression),a=(o.length,o[1]),s=n.attributes.getNamedItem("r-"+e);r.fn.bind(t)(n,s,a)}function sanitizeHTML(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}function parseAttribute(e){var t=/^([a-z0-9$_"]+)((?: ?#[a-z0-9]+)+)?$/i.exec(e.value),n=t[1],r=t[2],i={};return void 0!==r&&r.split("#").filter(function(e){return!!e.trim()}).map(function(e){return e.trim()}).forEach(function(e){i[e]=!0}),{name:e.name,value:n,originalValue:e.value,modifiers:i}}register("text",function(t,e){var r=this,n=e.value,i=function(e,t){"string"==typeof t&&(t=sanitizeHTML(t).replace(/ /g,"&nbsp;")),e.innerHTML=t};if(n)this.$_onChange(n,function(e){i(t,e)},!0);else{var o=/\{\{([a-z0-9_$]+)\}\}/gi;Array.from(t.querySelectorAll("*")).filter(function(e){return o.test(e.innerHTML)}).forEach(function(n){n.innerHTML.replace(o,function(e,t){r.$_onChange(t,function(e){i(n,e)},!0)})})}}),register("sync",function(t,e){var n=this;/^(?:INPUT|TAGNAME)$/.test(t.tagName)||error('<input> or <textarea> required for "sync" directive');var r=e.value;t.addEventListener("keydown",function(){setTimeout(function(){var e="number"===t.type?Number(t.value):t.value;e!==n.state[r]&&(n.state[r]=e)},0)}),this.$_onChange(r,function(e){t.value=e},!0)}),register("on*",function(e,t,n){t=parseAttribute(t),console.log(t),e.addEventListener(n,function(e){t.modifiers.prevent&&e.preventDefault()},{once:t.modifiers.once,passive:t.modifiers.passive,capture:t.modifiers.capture})},!0),register("class-*",function(t,e,n){var r=e.value||n;this.$_onChange(r,function(e){t.classList[e?"add":"remove"](n)},!0)},!0);var Ryo=function(e,t){var n=this;"string"==typeof e?this.el=document.querySelector(e):e instanceof HTMLElement?this.el=e:error$1("wrong selector or element: expected element or string"),this.state=t.state||{},this.actions=t.actions||{},Object.keys(this.actions).forEach(function(e){n.actions[e]=n.actions[e].bind(n)}),this.$_events={},this.$_init()};Ryo.prototype.$_initStateProxy=function(){var r=this;this.state=new Proxy(this.state,{get:function(e,t){if(t in e)return e[t];error$1("property "+t+" does'nt exist in state.")},set:function(e,t,n){return t in e||error$1('property "'+t+"\" does'nt exist in state."),e[t]=n,r.$_emit(t),!0}})},Ryo.prototype.$_emit=function(t){var n=this;t in this.$_events||(this.$_events[t]=[]),this.$_events[t].forEach(function(e){e(n.state[t])})},Ryo.prototype.$_onChange=function(e,t,n){var r=this.$_events[e];void 0===r&&(r=[]),r.push(t),this.$_events[e]=r,n&&this.$_emit(e)},Ryo.prototype.$_init=function(){var n=this;this.$_initStateProxy(),this.el.querySelectorAll("*").forEach(function(t){Array.from(t.attributes).map(function(e){return e.name}).filter(function(e){return/^r-/.test(e)}).forEach(function(e){exec(e.replace(/:.*$/,"").replace(/^r-/,""),n,t)})})},module.exports=Ryo;
