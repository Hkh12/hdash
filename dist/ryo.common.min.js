"use strict";function error$1(t,e){var n="[ryo"+(e?"":" error")+"] "+t;if(!e)throw new Error(n);console.warn(n)}var alld=[];function register(t,e){t=t.toLowerCase(),/^[a-z]+(?:-?\*)?$/.test(t)||error$1('invalid directive name "'+t+'"');var n=new RegExp(t.replace(/\*$/,"([a-z]+)")+"$"),r={name:t,expression:n,fn:e};alld.push(r)}function exec(t,e,n){for(var r=null,i=0,s=alld.length;i<s;i++)if(alld[i].expression.test(t)){r=alld[i];break}null===r&&error$1('directive "'+t+'" not found');var o=t.match(r.expression),a=(o.length,o[1]),c=n.attributes.getNamedItem("r-"+t);r.fn.bind(e)(n,c,a)}function sanitizeHTML(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}register("text",function(t,e){var n,r=e.value;r&&this.$_onChange(r,(n=t,function(t){"string"==typeof t&&(t=sanitizeHTML(t).replace(/  /g,"&nbsp;&nbsp;")),n.innerHTML=t}),!0)}),register("sync",function(e,t){var n=this;/^(?:INPUT|TAGNAME)$/.test(e.tagName)||error('<input> or <textarea> required for "sync" directive');var r=t.value;e.addEventListener("keydown",function(){setTimeout(function(){var t="number"===e.type?Number(e.value):e.value;t!==n.state[r]&&(n.state[r]=t)},0)}),this.$_onChange(r,function(t){e.value=t},!0)}),register("on*",function(t,e,n){var r=this,i=/^([a-zA-Z0-9$_]+)(\+\+|--|['"`]|!)?(?:  \| ((?: [a-z]+)+))?$/.exec(e.value),s=i[1],o=i[2],a=i[3],c={},u=void 0===o;"string"==typeof a&&a.trimLeft().split(" ").forEach(function(t){c[a]=!0}),t.addEventListener(n,function(t){if(c.prevent&&t.preventDefault(),u)r.actions[s]();else{if(/'|"|`/.test(o))return r.state[s]="";switch(o){case"--":r.state[s]--;break;case"++":r.state[s]++;break;case"!":r.state[s]=!r.state[s]}}},{once:c.once,passive:c.passive,capture:c.capture})}),register("class-*",function(e,t,n){var r=t.value||n;this.$_onChange(r,function(t){e.classList[t?"add":"remove"](n)},!0)},!0);var Ryo=function(t,e){var n=this;"string"==typeof t?this.el=document.querySelector(t):t instanceof HTMLElement?this.el=t:error$1("wrong selector or element: expected element or string"),this.state=e.state||{},this.actions=e.actions||{},Object.keys(this.actions).forEach(function(t){n.actions[t]=n.actions[t].bind(n)}),this.$_events={},this.$_init()};Ryo.prototype.$_initStateProxy=function(){var r=this;this.state=new Proxy(this.state,{get:function(t,e){if(e in t)return t[e];error$1("property "+e+" does'nt exist in state.")},set:function(t,e,n){return e in t||error$1('property "'+e+"\" does'nt exist in state."),t[e]=n,r.$_emit(e),!0}})},Ryo.prototype.$_emit=function(e){var n=this;e in this.$_events||(this.$_events[e]=[]),this.$_events[e].forEach(function(t){t(n.state[e])})},Ryo.prototype.$_onChange=function(t,e,n){var r=this.$_events[t];void 0===r&&(r=[]),r.push(e),this.$_events[t]=r,n&&this.$_emit(t)},Ryo.prototype.$_init=function(){var n=this;this.$_initStateProxy(),this.el.querySelectorAll("*").forEach(function(e){Array.from(e.attributes).map(function(t){return t.name}).filter(function(t){return/^r-/.test(t)}).forEach(function(t){exec(t.replace(/^r-/,""),n,e)})})},module.exports=Ryo;
