"use strict";function error(e,t){var r="[hdash"+(t?"":" error")+"] "+e;if(!t)throw new Error(r);console.warn(r)}function record(e,t){var r={};return e.forEach(function(e){r[e]=t}),r}function camel(e){return e.replace(/-(.)/g,function(e,t){return/[a-z]/.test(t)?t.toUpperCase():t})}function parse(e){var t=/((?: --(?:(?:[a-z]+-)*[a-z0-9]+)+)+)$/,r=e.replace(t,""),n=t.exec(e),i={};null!==(n=null===n?null:n[0])&&(i=record(n.split(" --").filter(function(e){return!!e}).map(camel),!0));return{value:r,modifiers:i}}var alld=[];function register(e,t,r){void 0===r&&(r=1),/^[a-z]+$/.test(e)||error('invalid directive name "'+e+'"; only a-z and numbers, wildcard at end (could be seperated with a hyphen)'),alld.push({name:e,fn:t,arg:r})}function exec(e,t,r,n){for(var i=null,a=0,o=alld.length;a<o;a++)if(alld[a].name===e){i=alld[a];break}null===i&&error('directive "'+e+'" not found');var s=parse(n.getAttribute(e+":"+t));i.fn.call(r,n,Object.assign({},s,{arg:t}))}function sanitizeHTML(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}function arrayUnique(n){return n.filter(function(e,t,r){return n.indexOf(e)===t})}function keyboardEvent(e){return{alt:e.altKey,shift:e.shiftKey,ctrl:e.ctrlKey,meta:e.metaKey,key:e.which}}register("text",function(t,e){var i=this,r=e.value;if(r)this.$_onChange(r,function(e){e=sanitizeHTML(e=String(e)).replace(/  /g,"&nbsp;&nbsp;").replace(/\n/g,"<br>"),t.innerHTML=e},!0);else{var a=/\{\{\w+\}\}/gi,o=function(e){return e.replace(/^\{\{/,"").replace(/\}\}$/,"")},n=Array.from(t.children);n.unshift(t),n.forEach(function(e){Array.from(e.childNodes).filter(function(e){return 3===e.nodeType}).filter(function(e){return!!e.textContent.trim()}).filter(function(e){return a.test(e.textContent)}).forEach(function(r){var n=r.textContent;arrayUnique(n.match(a).map(o)).forEach(function(t){i.$_onChange(t,function(e){r.textContent=n.replace(new RegExp("\\{\\{"+t+"\\}\\}","g"),e)},!0)})})})}}),register("model",function(r,e){var n=this,i=e.value,a=e.modifiers;/^(?:INPUT|TEXTAREA)$/.test(r.tagName)||error('<input> or <textarea> required for "model" directive');var t=a.lazy?"change":"keydown";r.addEventListener(t,function(){setTimeout(function(){var e=r.value,t="number"===r.type;t&&(e=Number(e)),a.trim&&!t&&(e=e.trim()),e!==n.state[i]&&(n.state[i]=e)},0)}),this.$_onChange(i,function(e){r.value=e},!0)}),register("on",function(e,c){var u=this,l=/^key(?:down|up|press)$/.test(c.arg);e.addEventListener(c.arg,function(e){c.modifiers.prevent&&e.preventDefault();var t=/(?:--|\+\+|[`"']|!|:null)$/,r=c.value,n=r.match(t),i=null===n;if(n=null===n?null:n[0],l){var a=keyboardEvent(e),o={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,capslock:20,esc:27,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46},s=Object.keys(c.modifiers).filter(function(e){return/^key/.test(e)}).map(function(e){return e.replace(/^key/,"").toLowerCase()});if(1<(s=s.length?a.key:s[0]).length&&error("more than one keys are declared for "+eventName,!0),/^[a-z]$/.test(s)&&(s=s.charCodeAt(0)-32),s in o&&(s=o[s]),s!=a.key||"shift"in c.modifiers!==a.shift||"alt"in c.modifiers!==a.alt||"meta"in c.modifiers!==a.meta||"ctrl"in c.modifiers!==a.ctrl)return}if(i)u.actions[r](e);else{if(r=r.replace(t,""),/'|"|`/.test(n))return u.state[r]="";switch(n){case"-":u.state[r]--;break;case"+":u.state[r]++;break;case"!":u.state[r]=!u.state[r];break;case":null":u.state[r]=null}}},{once:c.modifiers.once,passive:c.modifiers.passive,capture:c.modifiers.capture})}),register("class",function(t,e){var r=e.value,n=e.arg;this.$_onChange(r||n,function(e){t.classList[e?"add":"remove"](n)},!0)});var Hdash=function(e,t){"string"==typeof e?this.el=document.querySelector(e):e instanceof HTMLElement?this.el=e:error("wrong selector or element: expected element or string, got "+String(e)),this.state=t.state||{},this.actions=t.actions||{},this.watchers=t.watchers||{},this.$_events={},this.$_init()};Hdash.prototype.$_initProxy=function(){var n=this;this.state=new Proxy(this.state,{get:function(e,t){if(t in e)return e[t];error('unknown state property "'+t+'"')},set:function(e,t,r){return t in e||error('unknown state property "'+t+'"'),e[t]=r,n.$_emit(t),!0}})},Hdash.prototype.$_emit=function(t){var r=this;t in this.$_events||(this.$_events[t]=[]),this.$_events[t].forEach(function(e){e(r.state[t])})},Hdash.prototype.$_onChange=function(e,t,r){var n=this.$_events[e];void 0===n&&(n=[]),n.push(t),this.$_events[e]=n,r&&this.$_emit(e)},Hdash.prototype.$_init=function(){var t=this;Object.keys(this.actions).forEach(function(e){t.actions[e]=t.actions[e].bind(t)}),Object.keys(this.watchers).forEach(function(e){t.$_onChange(e,t.watchers[e].bind(t))}),this.$_initProxy(),this.el.querySelectorAll("*").forEach(this.$_execDirectives.bind(this)),this.$_observe()},Hdash.prototype.$_execDirectives=function(i){var a=this;Array.from(i.attributes).map(function(e){return e.name}).filter(function(e){return/^h-/.test(e)}).forEach(function(e){var t=/^([a-z]+(?:-[a-z]+)*)(:(?:[a-z]+))?$/.exec(e),r=t[1],n=t[2];n&&(n=n.replace(/^:/,"")),exec(r=r.replace(/^h-/,""),n,a,i)})},Hdash.prototype.$_observe=function(){var t=this;new MutationObserver(function(e){e.forEach(function(e){Array.from(e.addedNodes).filter(function(e){return"#text"!==e.nodeName}).forEach(t.$_execDirectives.bind(t))})}).observe(this.el,{childList:!0})},Hdash.directive=register,module.exports=Hdash;
