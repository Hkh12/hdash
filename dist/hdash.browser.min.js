var Hdash=function(){"use strict";function h(e,t){var n="[hdash"+(t?"":" error")+"] "+e;if(!t)throw new Error(n);console.warn(n)}function o(e,t){h(e+"\n -------\n(at "+function(e,t){void 0===t&&(t="body"),"string"==typeof t&&(t=document.querySelector(t));for(var n=[];e!==t;)n.unshift(e),e=e.parentElement;return n.unshift(t),(n=n.map(function(e){var t=e.tagName.toLowerCase();return e.className&&(t+="."+e.className.trim().split(" ").join(".")),e.id&&(t+="#"+e.id),t=t.replace(/^div([^$]+)/,"$1")})).join(" > ")}(t)+")")}function u(e){return e.replace(/-(.)/g,function(e,t){return/[a-z]/.test(t)?t.toUpperCase():t})}var f=[];function e(e,t,n){void 0===n&&(n=1),/^[a-z]+$/.test(e)||h('invalid directive name "'+e+'"; only a-z and numbers are accepted'),f.push({name:e,fn:t,arg:n})}function s(e,t,n,r){for(var i=null,a=0,o=f.length;a<o;a++)if(f[a].name===e){i=f[a];break}switch(null===i&&h('directive "'+e+'" not found'),i.arg){case 0:t&&h('no argument is accepted for directive "'+e+'" (got "'+t+'")');break;case 2:t||h('argument is required for directive "'+e+'"')}var s="h-"+(t?e+":"+t:e),c=function(e){var t,n,r=/((?: --(?:(?:[a-z]+-)*[a-z0-9]+)+)+)$/,i=e.replace(r,""),a=r.exec(e),o={};if(null!==(a=null===a?null:a[0])){var s=a.split(" --").filter(function(e){return!!e}).map(u);t=!0,n={},s.forEach(function(e){n[e]=t}),o=n}return{value:i,modifiers:o}}(r.getAttribute(s));i.fn.call(n,r,Object.assign({},c,{arg:t}))}e("text",function(n,e){var a=this,t=e.value;if(t)this.$_onChange(t,function(e){var t;e=String(e),e=(t=e,t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")).replace(/  /g,"&nbsp;&nbsp;").replace(/\n/g,"<br>"),n.innerHTML=e},!0);else{var o=/\{\{\w+\}\}/gi,s=function(e){return e.replace(/^\{\{/,"").replace(/\}\}$/,"")},r=Array.from(n.children);r.unshift(n),r.forEach(function(e){Array.from(e.childNodes).filter(function(e){return 3===e.nodeType}).filter(function(e){return!!e.textContent.trim()}).filter(function(e){return o.test(e.textContent)}).forEach(function(n){var r,i=n.textContent;(r=i.match(o).map(s)).filter(function(e,t,n){return r.indexOf(e)===t}).forEach(function(t){a.$_onChange(t,function(e){n.textContent=i.replace(new RegExp("\\{\\{"+t+"\\}\\}","g"),e)},!0)})})})}},0),e("model",function(n,e){var r=this,i=e.value,a=e.modifiers;/^(?:INPUT|TEXTAREA)$/.test(n.tagName)||o('<input> or <textarea> required for "model" directive',n);var t=a.lazy?"change":"keydown";n.addEventListener(t,function(){setTimeout(function(){var e=n.value,t="number"===n.type;t&&(e=Number(e)),a.trim&&!t&&(e=e.trim()),e!==r.state[i]&&(r.state[i]=e)},0)}),this.$_onChange(i,function(e){n.value=e},!0)},0),e("on",function(e,u){var f=this,l=/^key(?:down|up|press)$/.test(u.arg);e.addEventListener(u.arg,function(e){u.modifiers.prevent&&e.preventDefault();var t,n=/(?:--|\+\+|[`"']|!|:null)$/,r=u.value,i=r.match(n),a=null===i;if(i=null===i?null:i[0],l){var o={alt:(t=e).altKey,shift:t.shiftKey,ctrl:t.ctrlKey,meta:t.metaKey,key:t.which},s={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,capslock:20,esc:27,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46},c=Object.keys(u.modifiers).filter(function(e){return/^key/.test(e)}).map(function(e){return e.replace(/^key/,"").toLowerCase()});if(1<(c=c.length?o.key:c[0]).length&&h("more than one keys are declared for "+eventName,!0),/^[a-z]$/.test(c)&&(c=c.charCodeAt(0)-32),c in s&&(c=s[c]),c!=o.key||"shift"in u.modifiers!==o.shift||"alt"in u.modifiers!==o.alt||"meta"in u.modifiers!==o.meta||"ctrl"in u.modifiers!==o.ctrl)return}if(a)f.actions[r](e);else{if(r=r.replace(n,""),/'|"|`/.test(i))return f.state[r]="";switch(i){case"-":f.state[r]--;break;case"+":f.state[r]++;break;case"!":f.state[r]=!f.state[r];break;case":null":f.state[r]=null}}},{once:u.modifiers.once,passive:u.modifiers.passive,capture:u.modifiers.capture})},2),e("class",function(t,e){var n=e.value,r=e.arg;this.$_onChange(n||r,function(e){t.classList[e?"add":"remove"](r)},!0)});var t=function e(t,n){!this instanceof e&&h("Hdash must be called with new operator"),"string"==typeof t?this.el=document.querySelector(t):t instanceof HTMLElement?this.el=t:h('wrong selector or element: expected element or string, got "'+String(t)+'"'),this.state=n.state||{},this.actions=n.actions||{},this.watchers=n.watchers||{},this.$_events={},this.$_init()};return t.prototype.$_initProxy=function(){var r=this;this.state=new Proxy(this.state,{get:function(e,t){if(t in e)return e[t];h('unknown state property "'+t+'"')},set:function(e,t,n){return t in e||h('unknown state property "'+t+'"'),e[t]=n,r.$_emit(t),!0}})},t.prototype.$_emit=function(t){var n=this;t in this.$_events||(this.$_events[t]=[]),this.$_events[t].forEach(function(e){e(n.state[t])})},t.prototype.$_onChange=function(e,t,n){var r=this.$_events[e];void 0===r&&(r=[]),r.push(t),this.$_events[e]=r,n&&this.$_emit(e)},t.prototype.$_init=function(){var t=this;Object.keys(this.actions).forEach(function(e){t.actions[e]=t.actions[e].bind(t)}),Object.keys(this.watchers).forEach(function(e){t.$_onChange(e,t.watchers[e].bind(t))}),this.$_initProxy(),this.el.querySelectorAll("*").forEach(this.$_execDirectives.bind(this)),this.$_observe()},t.prototype.$_execDirectives=function(i){var a=this;Array.from(i.attributes).map(function(e){return e.name}).filter(function(e){return/^h-/.test(e)}).forEach(function(e){var t=/^([a-z]+(?:-[a-z]+)*)(:(?:[a-z]+))?$/.exec(e),n=t[1],r=t[2];r&&(r=r.replace(/^:/,"")),s(n=n.replace(/^h-/,""),r,a,i)})},t.prototype.$_observe=function(){var t=this;new MutationObserver(function(e){e.forEach(function(e){Array.from(e.addedNodes).filter(function(e){return"#text"!==e.nodeName}).forEach(t.$_execDirectives.bind(t))})}).observe(this.el,{childList:!0})},t.directive=e,t}();
