var Hdash=function(){function t(t,e){var n="[hdash"+(e?"":" error")+"] "+t;if(!e)throw new Error(n);console.warn(n)}function e(e,n,r){t(e+"\n -------\n(at "+function(t,e){void 0===e&&(e="body"),"string"==typeof e&&(e=document.querySelector(e));for(var n=[];t!==e;)n.unshift(t),t=t.parentElement;return n.unshift(e),(n=n.map(function(t){var e=t.tagName.toLowerCase();return t.className&&(e+="."+t.className.trim().split(" ").join(".")),t.id&&(e+="#"+t.id),e=e.replace(/^div([^$]+)/,"$1")})).join(" > ")}(n)+")",r)}function n(t){for(var e=[],r=0,i=t.childNodes;r<i.length;r+=1){var a=i[r],o=a.nodeType;o===document.TEXT_NODE?e.push(a):o===document.ELEMENT_NODE&&(e=e.concat(n(a)))}return e.filter(function(t){return/\S+/g.test(t.textContent)})}function r(t){return t.replace(/\{ /g,"").replace(/ \}/g,"")}var i=/\{ \w+(?: \| \w+)* \}/gi,a={};function o(e,n,r){void 0===r&&(r="optional"),e in a&&t('directive "'+e+'" already exists'),["optional","empty","required"].includes(r)||t('argument state for directive "'+e+'" is not valid. choosing the default value ("optional")',!0),/^[a-z]+(?:-[a-z]+)*$/.test(e)||t('"'+e+'" is not a valid directive name'),a[e]={argState:r,callback:n}}var c=a;o("model",{ready:function(t,e,n){var r=this,i=n.lazy;t.value=this.state[e],t.addEventListener("change",function(){var n=t.value;"checkbox"===t.type&&(n=t.checked),r.state[e]=n}),"text"!==t.type||i||t.addEventListener("keydown",function(){setTimeout(function(){r.state[e]=t.value},0)})},updated:function(t,e){var n="value";"checkbox"===t.type&&(n="checked"),t[n]!==this.state[e]&&(t[n]=this.state[e])}},"empty"),o("class",function(t,e,n,r){var i=e||r;this.$on(i,function(n){t.classList[n?"add":"remove"](r||e)},{immediate:!0,id:t,type:"DIRECTIVE"})},"required"),o("on",function(t,e,n,r){var i=this,a=/ = (.*)$/,o=(e.match(a)||[])[1],c=!!o,s=e.replace(a,"");t.addEventListener(r,function(t){var r;(n.prevent&&t.preventDefault(),c)?(r=['""',"''","``"].includes(o)?"":"null"===o?null:"true"===o||"false"!==o&&("!0"===o||"!1"!==o&&(isNaN(Number(o))||"Infinity"===o?i.state[o]:Number(o))),i.state[s]=r):i.actions[e]()},{once:n.once,passive:n.passive,capture:n.capture})},"required");var s=function e(n,r){!this instanceof e&&t("Hdash must be called with new operator"),"string"==typeof n?this.$el=document.querySelector(n):n instanceof HTMLElement?this.$el=n:t('wrong selector or element: expected element or string, got "'+String(n)+'"'),this.state=r.state||{},this.actions=r.actions||{},this.$watchers=r.watchers||{},this.$formatters=r.formatters||{},this.$events=[],this.$init()};return s.prototype.$init=function(){var t=this;Object.keys(this.actions).forEach(function(e){t.actions[e]=t.actions[e].bind(t)}),Object.keys(this.$watchers).forEach(function(e){t.$on(e,t.$watchers[e])}),this.$initProxy(),this.$el.querySelectorAll("*").forEach(this.$execDirectives.bind(this)),this.$interpolation(),this.$observe()},s.prototype.$initProxy=function(){var e=this,n={get:function(e,n){return e.hasOwnProperty(n)||t('unknown state property "'+n+'"'),e[n]},set:function(n,r,i){return n.hasOwnProperty(r)||t('unknown state property "'+r+'"'),n[r]=i,e.$emit(r),e.$emit(),!0}};this.state=new Proxy(this.state,n)},s.prototype.$execDirectives=function(t){var n=this;if(t.attributes&&t.attributes.length)for(var r=function(){var r=a[i],o=r.name,s=r.arg,u=r.modifiers,f=c[o];switch(void 0===f&&e('directive "'+o+'" not found',t),f.argState){case"empty":s&&e('directive "'+o+'" needed no arguments, but there is an argument',t);break;case"required":s||e("directive needs an arguments, but there's nothing",t)}var l=t.getAttribute(function(t){var e="h-"+t.name;t.arg&&(e+=":"+t.arg);var n=Object.keys(t.modifiers);return n.length&&(e+="."+n.join(".")),e}({name:o,arg:s,modifiers:u})),d=[t,l,u,s];"function"==typeof f.callback?f.callback.apply(n,d):("ready"in f.callback&&f.callback.ready.apply(n,d),"updated"in f.callback&&n.$on("",function(){f.callback.updated.apply(n,d)},{type:"DIRECTIVE",id:t}))},i=0,a=function(t){return Array.from(t.attributes).map(function(t){return t.name}).filter(function(t){return/^h-/.test(t)}).map(function(t){return t.replace(/^h-/,"")}).map(function(t){var e,n,r,i=t.match(/^([a-z]+(?:-[a-z]+)*)(:[a-z0-9]+)?((?:\.[a-z0-9]+))*$/),a=i[1],o=i[2],c=i[3];return o&&(o=o.replace(/^:/,"")),c?(e=c.split(".").filter(Boolean),n=!0,r={},e.forEach(function(t){r[t]=n}),c=r):c={},{name:a,arg:o,modifiers:c}}).filter(function(n,r,i){var a=function(t){return t.arg?[t.name,t.arg].join(":"):t.name},o=a(n),c=i.filter(function(t){return a(t)===o});return c.length>1?(e("duplicate directive "+n.name,t,!0),c[0]):n})}(t);i<a.length;i+=1)r()},s.prototype.$interpolation=function(){n(this.$el).forEach(this.$interpolateNode.bind(this))},s.prototype.$interpolateNode=function(e){var n=this;if(a=e.textContent,/\{ \w+(?: \| \w+)* \}/gi.test(a))for(var a,o,c=(o=e.textContent.match(i).map(r)).filter(function(t,e){return o.indexOf(t)===e}),s=e.textContent,u=function(){var r=l[f],i=r.split(" | "),a=i[0],o=i.slice(1),c=new RegExp("\\{ "+r.replace(/\|/g,"\\|")+" \\}","g"),u=function(e,n){return e.length?e.map(function(e){if(e in n)return n[e];t("formatter "+e+" not found")}).reduce(function(t,e){return function(n){return e(t(n))}}):function(t){return t}}(o,n.$formatters);n.$on(a,function(t){var r=s.replace(c,u.call(n,t));e.textContent!==r&&(e.textContent=r)},{immediate:!0,type:"INTERPOLATION",id:e})},f=0,l=c;f<l.length;f+=1)u()},s.prototype.$observe=function(){var t=this;new MutationObserver(function(e){for(var r=0,i=e;r<i.length;r+=1){for(var a=i[r],o=a.addedNodes,c=a.removedNodes,s=0,u=o;s<u.length;s+=1){var f=u[s];switch(f.nodeType){case document.TEXT_NODE:t.$interpolateNode(f);case document.ELEMENT_NODE:n(f).forEach(t.$interpolateNode.bind(t)),t.$execDirectives(f)}}for(var l=function(){var e=p[d],r=function(e){t.$events.filter(function(t){return"INTERPOLATION"===t.type&&t.id===e}).map(function(e){return t.$events.indexOf(e)}).forEach(function(e){t.$events.splice(e,1)})};e.nodeType===document.TEXT_NODE?r(e):e.nodeType===document.ELEMENT_NODE&&(n(e).forEach(r),t.$events.filter(function(t){return"DIRECTIVE"===t.type&&t.id===e}).map(function(e){return t.$events.indexOf(e)}).forEach(function(e){t.$events.splice(e,1)}))},d=0,p=c;d<p.length;d+=1)l()}}).observe(this.$el,{childList:!0,subtree:!0})},s.prototype.$on=function(t,e,n){this.$events.push({key:t,fn:e,type:n.type,id:n.id}),n.immediate&&this.$emit(t)},s.prototype.$emit=function(t){var e=this;this.$events.filter(function(e){return!t||e.key===t}).forEach(function(t){var n=t.key?[e.state[t.key]]:[];t.fn.apply(e,n)})},s.directive=o,s}();
