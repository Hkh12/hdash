var Hdash=function(){function t(t,e){var n="[hdash"+(e?"":" error")+"] "+t;if(!e)throw new Error(n);console.warn(n)}function e(e,n,i){t(e+"\n -------\n(at "+function(t,e){void 0===e&&(e="body"),"string"==typeof e&&(e=document.querySelector(e));for(var n=[];t!==e;)n.unshift(t),t=t.parentElement;return n.unshift(e),(n=n.map(function(t){var e=t.tagName.toLowerCase();return t.className&&(e+="."+t.className.trim().split(" ").join(".")),t.id&&(e+="#"+t.id),e=e.replace(/^div([^$]+)/,"$1")})).join(" > ")}(n)+")",i)}function n(t){for(var e=[],i=0,r=t.childNodes;i<r.length;i+=1){var o=r[i],a=o.nodeType;a===document.TEXT_NODE?e.push(o):a===document.ELEMENT_NODE&&(e=e.concat(n(o)))}return e.filter(function(t){return/\S+/g.test(t.textContent)})}function i(t){return t.replace(/\{ /g,"").replace(/ \}/g,"")}var r=/\{ \w+(?: \| \w+)* \}/gi;var o={};function a(e,n,i){void 0===i&&(i="optional"),e in o&&t('directive "'+e+'" already exists'),["optional","empty","required"].includes(i)||t('argument state for directive "'+e+'" is not valid. choosing the default value ("optional")',!0),/^[a-z]+(?:-[a-z]+)*$/.test(e)||t('"'+e+'" is not a valid directive name'),o[e]={argState:i,callback:n}}var c=o;a("model",{ready:function(t,e){var n=this;t.value=this.state[e],t.addEventListener("keydown",function(){setTimeout(function(){n.state[e]=t.value},0)})},updated:function(t,e){t.value!==this.state[e]&&(t.value=this.state[e])}},"empty");var s=function(t,e,n,i){t.classList[!!this.state[e||i]?"add":"remove"](i||e)};a("class",{ready:s,updated:s},"required"),a("on",function(t,e,n,i){var r=this,o=/ = (.*)$/,a=(e.match(o)||[])[1],c=!!a,s=e.replace(o,"");t.addEventListener(i,function(){var t;c?(t=['""',"''","``"].includes(a)?"":"null"===a?null:"true"===a||"false"!==a&&("!0"===a||"!1"!==a&&(isNaN(Number(a))||"Infinity"===a?r.state[a]:Number(a))),r.state[s]=t):r.actions[e]()},{once:n.once,passive:n.passive,capture:n.once})},"required");var u=function e(n,i){!this instanceof e&&t("Hdash must be called with new operator"),"string"==typeof n?this.$el=document.querySelector(n):n instanceof HTMLElement?this.$el=n:t('wrong selector or element: expected element or string, got "'+String(n)+'"'),this.state=i.state||{},this.actions=i.actions||{},this.$watchers=i.watchers||{},this.$formatters=i.formatters||{},this.$events=[],this.$init()};return u.prototype.$init=function(){var t=this;Object.keys(this.actions).forEach(function(e){t.actions[e]=t.actions[e].bind(t)}),Object.keys(this.$watchers).forEach(function(e){t.$on(e,t.$watchers[e])}),this.$initProxy(),this.$el.querySelectorAll("*").forEach(this.$execDirectives.bind(this)),this.$interpolation(),this.$observe()},u.prototype.$initProxy=function(){var e=this;this.state=new Proxy(this.state,{get:function(e,n){if(n in e)return e[n];t('unknown state property "'+n+'"')},set:function(n,i,r){return!i in n&&t('unknown state property "'+i+'"'),n[i]=r,e.$emit(i),e.$emit(),!0}})},u.prototype.$execDirectives=function(t){for(var n=this,i=function(){var i=o[r],a=i.name,s=i.arg,u=i.modifiers,f=c[a];switch(void 0===f&&e('directive "'+a+'" not found',t),f.argState){case"empty":s&&e('directive "'+a+'" needed no arguments, but there is an argument',t);break;case"required":s||e("directive needs an arguments, but there's nothing",t)}var l=t.getAttribute("h-"+(s?a+":"+s:a)),d=[t,l,u,s];"function"==typeof f.callback?f.callback.apply(n,d):("ready"in f.callback&&f.callback.ready.apply(n,d),"updated"in f.callback&&n.$on("",function(){f.callback.updated.apply(n,d)},{type:"DIRECTIVE"}))},r=0,o=function(t){return Array.from(t.attributes).map(function(t){return t.name}).filter(function(t){return/^h-/.test(t)}).map(function(t){return t.replace(/^h-/,"")}).map(function(t){var e,n,i,r=t.match(/^([a-z]+(?:-[a-z]+)*)(:[a-z0-9]+)?((?:\.[a-z0-9]+))*$/),o=r[1],a=r[2],c=r[3];return a&&(a=a.replace(/^:/,"")),c?(e=c.split(".").filter(Boolean),n=!0,i={},e.forEach(function(t){i[t]=n}),c=i):c={},{name:o,arg:a,modifiers:c}}).filter(function(n,i,r){var o=function(t){return t.arg?[t.name,t.arg].join(":"):t.name},a=o(n),c=r.filter(function(t){return o(t)===a});return c.length>1?(e("duplicate directive "+n.name,t,!0),c[0]):n})}(t);r<o.length;r+=1)i()},u.prototype.$interpolation=function(){n(this.$el).forEach(this.$interpolateNode.bind(this))},u.prototype.$interpolateNode=function(e){var n=this;if(o=e.textContent,/\{ \w+(?: \| \w+)* \}/gi.test(o))for(var o,a,c=(a=e.textContent.match(r).map(i)).filter(function(t,e,n){return a.indexOf(t)===e}),s=e.textContent,u=function(){var i=l[f],r=i.split(" | "),o=r[0],a=r.slice(1),c=new RegExp("\\{ "+i.replace(/\|/g,"\\|")+" \\}","g");a=a.length?a.map(function(e){if(e in n.$formatters)return n.$formatters[e];t('formatter "'+e+'" not found')}).reduce(function(t,e){return function(n){return e(t(n))}}):function(t){return t},n.$on(o,function(t){var n=s.replace(c,a(t));e.textContent!==n&&(e.textContent=n)},{immediate:!0,type:"INTERPOLATION",id:e})},f=0,l=c;f<l.length;f+=1)u()},u.prototype.$observe=function(){var t=this;new MutationObserver(function(e){e.forEach(function(e){for(var i=0,r=e.addedNodes;i<r.length;i+=1){var o=r[i];o.nodeType===document.TEXT_NODE&&t.$interpolateNode(o)}for(var a=0,c=e.removedNodes;a<c.length;a+=1){var s=c[a],u=function(e){t.$events.filter(function(t){return"INTERPOLATION"===t.type&&t.id===e}).map(function(e){return t.$events.indexOf(e)}).forEach(function(e){t.$events.splice(e,1)})};s.nodeType===document.TEXT_NODE?u(s):s.nodeType===document.ELEMENT_NODE&&n(s).forEach(u)}})}).observe(this.$el,{childList:!0,subtree:!0})},u.prototype.$on=function(t,e,n){this.$events.push({key:t,fn:e,type:n.type,id:n.id}),n.immediate&&this.$emit(t)},u.prototype.$emit=function(t){var e=this;this.$events.filter(function(e){return!t||e.key===t}).forEach(function(t){var n=t.key?[e.state[t.key]]:[];t.fn.apply(e,n)})},u}();
