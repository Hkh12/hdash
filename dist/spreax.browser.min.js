var Spreax=function(){function e(e,t){var n="[spreax"+(t?"":" error")+"] "+e;if(!t)throw new Error(n);console.warn(n)}function t(t,n,r){e(t+"\n -------\n(at "+function(e,t){void 0===t&&(t="body"),"string"==typeof t&&(t=document.querySelector(t));for(var n=[];e!==t;)n.unshift(e),e=e.parentElement;return n.unshift(t),(n=n.map(function(e){var t=e.tagName.toLowerCase();return e.className&&(t+="."+e.className.trim().split(" ").join(".")),e.id&&(t+="#"+e.id),t=t.replace(/^div([^$]+)/,"$1")})).join(" > ")}(n)+")",r)}function n(e){for(var t=[],r=0,i=e.childNodes;r<i.length;r+=1){var o=i[r],a=o.nodeType;a===document.TEXT_NODE?t.push(o):a===document.ELEMENT_NODE&&(t=t.concat(n(o)))}return t.filter(function(e){return/\S+/g.test(e.textContent)})}function r(e){return e.replace(/\{ /g,"").replace(/ \}/g,"")}var i=/\{ \w+(?: \| \w+)* \}/gi,o={};function a(t,n,r){void 0===r&&(r="optional"),t in o&&e('directive "'+t+'" already exists'),["optional","empty","required"].includes(r)||e('argument state for directive "'+t+'" is not valid. choosing the default value ("optional")',!0),/^[a-z]+(?:-[a-z]+)*$/.test(t)||e('"'+t+'" is not a valid directive name'),o[t]={argState:r,callback:n}}var c=o;a("on",function(e,t,n,r){var i=this,o=/ = (.*)$/,a=(t.match(o)||[])[1],c=!!a,u=t.replace(o,"");e.addEventListener(r,function(e){var r;(n.prevent&&e.preventDefault(),c)?(r=['""',"''","``"].includes(a)?"":"null"===a?null:"true"===a||"false"!==a&&("!0"===a||"!1"!==a&&(isNaN(Number(a))||"Infinity"===a?i[a]:Number(a))),i[u]=r):i[t]()},{once:n.once,passive:n.passive,capture:n.capture})},"required"),a("model",{ready:function(e,n,r){var i=this,o=r.lazy;/^(?:select|input|textarea)$/.test(e.tagName.toLowerCase())||t("model directive only works on input, textarea or select tags",e),"checkbox"===e.type?e.checked=!!this[n]:e.value=this[n],e.addEventListener("change",function(){var t=e.value;"checkbox"===e.type&&(t=e.checked),i[n]=t}),"text"!==e.type||o||e.addEventListener("keydown",function(){setTimeout(function(){i[n]=e.value},0)})},updated:function(e,t){var n="value";"checkbox"===e.type&&(n="checked"),e[n]!==this[t]&&(e[n]=this[t])}},"empty"),a("class",function(e,t,n,r){var i=t||r;this.$on(i,function(n){e.classList[n?"add":"remove"](r||t);var i=e.getAttribute("class");null===i||i.length||e.removeAttribute("class")},{immediate:!0,id:e,type:"DIRECTIVE"})},"required");var u=function t(n,r){this instanceof t||e("Spreax must be called with new operator"),"string"==typeof n?this.$el=document.querySelector(n):n instanceof HTMLElement?this.$el=n:e('wrong selector or element: expected element or string, got "'+String(n)+'"'),this.$events=[],this.$formatters={},this.$_proxy=null,this.$extendWith(r.state||{},r.actions||{},r.computed||{},r.formatters||{}),this.$interpolation(),this.$el.querySelectorAll("*").forEach(this.$execDirectives.bind(this)),this.$observe()};return u.prototype.$extendWith=function(e,t,n,r){var i=this;this.$makeProxy(e),Object.keys(e).forEach(function(e){Object.defineProperty(i,e,{get:function(){return i.$_proxy[e]},set:function(t){i.$_proxy[e]=t}})}),Object.entries(t).forEach(function(e){var t=e[0],n=e[1];i[t]=n.bind(i)}),Object.entries(n).forEach(function(e){var t=e[0],n=e[1];Object.defineProperty(i,t,{get:n.bind(i),set:function(){return!1}})}),Object.entries(r).forEach(function(e){var t=e[0],n=e[1];i.$formatters[t]=n.bind(i)})},u.prototype.$makeProxy=function(t){var n=this;this.$_proxy=new Proxy(t,{get:function(t,n){return t.hasOwnProperty(n)||e('unknown state property "'+n+'"'),t[n]},set:function(t,r,i){return t.hasOwnProperty(r)||e('unknown state property "'+r+'"'),t[r]=i,n.$emit(r),n.$emit(),!0},deleteProperty:function(){return!1}})},u.prototype.$pipeFormatters=function(t){return arguments.length>1?t=Array.prototype.slice.call(arguments):1===arguments.length&&"string"==typeof t&&(t=[t]),function(t,n){return t.length?t.map(function(t){if(t in n)return n[t];e("formatter "+t+" not found")}).reduce(function(e,t){return function(n){return t(e(n))}}):function(e){return e}}(t,this.$formatters).bind(this)},u.prototype.$execDirectives=function(e){var n=this;if(e.attributes&&e.attributes.length)for(var r=function(){var r=o[i],a=r.name,u=r.arg,s=r.modifiers,f=c[a];switch(void 0===f&&t('directive "'+a+'" not found',e),f.argState){case"empty":u&&t('directive "'+a+'" needed no arguments, but there is an argument',e);break;case"required":u||t("directive needs an arguments, but there's nothing",e)}var l=e.getAttribute(function(e){var t="h-"+e.name;e.arg&&(t+=":"+e.arg);var n=Object.keys(e.modifiers);return n.length&&(t+="."+n.join(".")),t}({name:a,arg:u,modifiers:s})),p=[e,l,s,u];"function"==typeof f.callback?f.callback.apply(n,p):("ready"in f.callback&&f.callback.ready.apply(n,p),"updated"in f.callback&&n.$on("",function(){f.callback.updated.apply(n,p)},{type:"DIRECTIVE",id:e}))},i=0,o=function(e){return Array.from(e.attributes).map(function(e){return e.name}).filter(function(e){return/^h-/.test(e)}).map(function(e){return e.replace(/^h-/,"")}).map(function(e){var t,n,r,i=e.match(/^([a-z]+(?:-[a-z]+)*)(:[a-z0-9]+)?((?:\.[a-z0-9]+))*$/),o=i[1],a=i[2],c=i[3];return a&&(a=a.replace(/^:/,"")),c?(t=c.split(".").filter(Boolean),n=!0,r={},t.forEach(function(e){r[e]=n}),c=r):c={},{name:o,arg:a,modifiers:c}}).filter(function(n,r,i){var o=function(e){return e.arg?[e.name,e.arg].join(":"):e.name},a=o(n),c=i.filter(function(e){return o(e)===a});return c.length>1?(t("duplicate directive "+n.name,e,!0),c[0]):n})}(e);i<o.length;i+=1)r()},u.prototype.$interpolation=function(){n(this.$el).forEach(this.$interpolateNode,this)},u.prototype.$interpolateNode=function(e){var t=this;if(n=e.textContent,/\{ \w+(?: \| \w+)* \}/gi.test(n))for(var n,o,a=(o=e.textContent.match(i).map(r)).filter(function(e,t){return o.indexOf(e)===t}),c=e.textContent,u=function(){var n=f[s],r=n.split(" | "),i=r[0],o=r.slice(1),a=new RegExp("\\{ "+n.replace(/\|/g,"\\|")+" \\}","g"),u=t.$pipeFormatters(o);t.$on(i,function(t){var n=c.replace(a,u(t));e.textContent!==n&&(e.textContent=n)},{immediate:!0,type:"INTERPOLATION",id:e})},s=0,f=a;s<f.length;s+=1)u()},u.prototype.$observe=function(){var e=this;new MutationObserver(function(t){for(var r=0,i=t;r<i.length;r+=1){for(var o=i[r],a=o.addedNodes,c=o.removedNodes,u=0,s=a;u<s.length;u+=1){var f=s[u];switch(f.nodeType){case document.TEXT_NODE:e.$interpolateNode(f);break;case document.ELEMENT_NODE:n(f).forEach(e.$interpolateNode,e),e.$execDirectives(f)}}for(var l=0,p=c;l<p.length;l+=1){var d=p[l],h=function(t,n){void 0===n&&(n="INTERPOLATION"),e.$events.filter(function(e){return e.type===n&&e.id===t}).map(function(t){return e.$events.indexOf(t)}).forEach(function(t){e.$events.splice(t,1)})};d.nodeType===document.TEXT_NODE?h(d):d.nodeType===document.ELEMENT_NODE&&(n(d).forEach(h),h(d,"DIRECTIVE"))}}}).observe(this.$el,{childList:!0,subtree:!0})},u.prototype.$on=function(e,t,n){void 0===n&&(n={}),this.$events.push({key:e,fn:t,type:n.type,id:n.id}),n.immediate&&this.$emit(e)},u.prototype.$emit=function(e){var t=this;this.$events.filter(function(t){return!e||t.key===e}).forEach(function(e){var n=e.key?[t[e.key]]:[];e.fn.apply(t,n)})},u.directive=a,u}();
