var Spreax=function(){var e={};function t(t,n,r){if(void 0===r&&(r="optional"),t in e)throw new Error('directive "'+t+'" already exists');if(["optional","empty","required"].includes(r)||console.warn('argument state for directive "'+t+'" is not valid. choosing the default value ("optional")'),!/^[a-z]+(?:-[a-z]+)*$/.test(t))throw new Error('"'+t+'" is not a valid directive name');e[t]={argState:r,callback:n}}var n=e,r={null:null,"!0":!0,"!1":!1,false:!1,true:!0,undefined:void 0};t("on",function(e,t,n,i){var o=this,a=/ = .+$/.test(t);e.addEventListener(i,function(e){if(n.prevent&&e.preventDefault(),a){var i=function(e){var t=e.match(/^(.+) = (.+)$/);if(null===t)throw new SyntaxError('string "'+e+'" is not a valid assignment statement');var n=t[1],i=t[2],o=!1;if(i in r)i=r[i];else if(isNaN(Number(i)))if(/^(['"`]).*\1$/.test(i))i=i.slice(1,-1);else{if(!/^\w+$/i.test(i))throw new SyntaxError('could not find any values matching "'+i+'"');o=!0}else i=Number(i);return{prop:n,getValue:function(e){return o?e[i]:i}}}(t);o[i.prop]=i.getValue(o)}else o[t]()},{once:n.once,passive:n.passive,capture:n.capture})},"required");var i=function(e){function t(t,n){e.call(this,t),this.message=t+"\n error at: "+function(e,t){void 0===t&&(t="body"),"string"==typeof t&&(t=document.querySelector(t));for(var n=[];e!==t;)n.unshift(e),e=e.parentElement;return n.unshift(t),(n=n.map(function(e){var t=e.tagName.toLowerCase();return e.className&&(t+="."+e.className.trim().split(" ").join(".")),e.id&&(t+="#"+e.id),t=t.replace(/^div([^$]+)/,"$1")})).join(" > ")}(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error);function o(e){for(var t=[],n=0,r=e.childNodes;n<r.length;n+=1){var i=r[n];if(/\S+/g.test(i.textContent)){var a=i.nodeType;a===Node.TEXT_NODE?t.push(i):a===Node.ELEMENT_NODE&&(t=t.concat(o(i)))}}return t}t("model",{ready:function(e,t,n){var r=this,o=n.lazy;if(!["select","input","textarea"].includes(e.tagName.toLowerCase()))throw new i("model directive only works on input, textarea or select tags",e);"checkbox"===e.type?e.checked=!!this[t]:e.value=this[t],e.addEventListener("change",function(){r[t]="checkbox"===e.type?e.checked:e.value}),"text"!==e.type||o||e.addEventListener("keydown",function(){setTimeout(function(){r[t]=e.value},0)})},updated:function(e,t){e["checkbox"===e.type?"checked":"value"]=this[t]}},"empty"),t("class",function(e,t,n,r){var i=t||r;this.$on(i,function(n){e.classList[n?"add":"remove"](r||t);var i=e.getAttribute("class");null===i||i.length||e.removeAttribute("class")},{immediate:!0,id:e,type:"DIRECTIVE"})},"required");var a=function(e,t){if("string"==typeof e)this.$el=document.querySelector(e);else{if(!(e instanceof HTMLElement))throw new TypeError('wrong selector or element: expected element or string, got "'+String(e)+'"');this.$el=e}this.$events=[],this.$formatters={},this.$_proxy=null,this.$extendWith(t.state||{},t.actions||{},t.computed||{},t.formatters||{}),o(this.$el).forEach(this.$interpolation,this),this.$el.querySelectorAll("*").forEach(this.$execDirectives,this),this.$observe()};return a.prototype.$extendWith=function(e,t,n,r){var i=this;this.$makeProxy(e),Object.keys(e).forEach(function(e){Object.defineProperty(i,e,{get:function(){return i.$_proxy[e]},set:function(t){i.$_proxy[e]=t}})}),Object.entries(t).forEach(function(e){var t=e[0],n=e[1];i[t]=n.bind(i)}),Object.entries(n).forEach(function(e){var t=e[0],n=e[1];Object.defineProperty(i,t,{get:n.bind(i),set:function(){return!1}})}),Object.entries(r).forEach(function(e){var t=e[0],n=e[1];i.$formatters[t]=n.bind(i)})},a.prototype.$makeProxy=function(e){var t=this;this.$_proxy=new Proxy(e,{get:function(e,t){if(!e.hasOwnProperty(t))throw new Error('unknown state property "'+t+'"');return e[t]},set:function(e,n,r){if(!e.hasOwnProperty(n))throw new Error('unknown state property "'+n+'"');if(r!==e[n])return e[n]=r,t.$emit(n),t.$emit(),!0},deleteProperty:function(){return!1}})},a.prototype.$pipeFormatters=function(e){return arguments.length>1?e=Array.prototype.slice.call(arguments):1===arguments.length&&"string"==typeof e&&(e=[e]),function(e,t){return e.length?e.map(function(e){if(e in t)return t[e];throw new Error("formatter "+e+" not found")}).reduce(function(e,t){return function(n){return t(e(n))}}):function(e){return e}}(e,this.$formatters).bind(this)},a.prototype.$execDirectives=function(e){var t=this;if(e.attributes&&e.attributes.length)for(var r=function(){var r=a[o],c=r.name,s=r.arg,u=r.modifiers,f=n[c];if(void 0===f)throw new i('directive "'+c+'" not found',e);switch(f.argState){case"empty":if(s)throw new i('directive "'+c+'" needed no arguments, but there is an argument',e);break;case"required":if(!s)throw new i("directive needs an arguments, but there's nothing",e)}var l=e.getAttribute(function(e){var t="sp-"+e.name;e.arg&&(t+=":"+e.arg);var n=Object.keys(e.modifiers);return n.length&&(t+="."+n.join(".")),t}({name:c,arg:s,modifiers:u})),p=[e,l,u,s];"function"==typeof f.callback?f.callback.apply(t,p):("ready"in f.callback&&f.callback.ready.apply(t,p),"updated"in f.callback&&t.$on("",function(){f.callback.updated.apply(t,p)},{type:"DIRECTIVE",id:e}))},o=0,a=function(e){return Array.from(e.attributes).map(function(e){return e.name}).filter(function(e){return/^sp-/.test(e)}).map(function(e){return e.replace(/^sp-/,"")}).map(function(e){var t,n,r,i=e.match(/^([a-z]+(?:-[a-z]+)*)(:[a-z0-9]+)?((?:\.[a-z0-9]+))*$/),o=i[1],a=i[2],c=i[3];return a&&(a=a.replace(/^:/,"")),c?(t=c.split(".").filter(Boolean),n=!0,r={},t.forEach(function(e){r[e]=n}),c=r):c={},{name:o,arg:a,modifiers:c}}).filter(function(e,t,n){var r=function(e){return e.arg?[e.name,e.arg].join(":"):e.name},i=r(e),o=n.filter(function(e){return r(e)===i});return o.length>1?o[0]:e})}(e);o<a.length;o+=1)r()},a.prototype.$interpolation=function(e){var t=this;!function(e,t){var n=/\{\{ ?\w+(?: \| \w+)* ?\}\}/gi,r=e.textContent;if(n.test(r)){var i=[];r.replace(n,function(e,t){return i.push({string:e,startIndex:t}),e});for(var o=0,a=i;o<a.length;o+=1){var c=a[o],s=c.string,u=c.startIndex,f=s.replace(/^\{\{ ?/,"").replace(/ ?\}\}$/,"").split(" | "),l=f[0];t({initialText:r,node:e,formatters:f.slice(1),match:{startIndex:u,string:s},propertyName:l})}}}(e,function(e){var n=e.initialText,r=e.node,i=e.propertyName,o=e.formatters,a=e.match,c=a.startIndex,s=a.string,u=t.$pipeFormatters(o);t.$on(i,function(e){e=String(u(e));var t=n.slice(0,c)+e+n.slice(c+s.length+e.length,n.length);n!==t&&(r.textContent=t)},{immediate:!0,type:"INTERPOLATION",id:r})})},a.prototype.$observe=function(){var e,t,n,r=this,i=function(e,t){void 0===t&&(t="INTERPOLATION");for(var n=r.$events.filter(function(n){return n.type===t&&n.id===e}).map(function(e,t){return t}),i=0,o=n;i<o.length;i+=1){var a=o[i];r.$events.splice(a,1)}};(e={textAdded:this.$interpolation,elementAdded:function(e){o(e).forEach(r.$interpolation,r),r.$execDirectives(e)},textRemoved:i,elementRemoved:function(e){o(e).forEach(i),i(e,"DIRECTIVE")}},t=Node.TEXT_NODE,n=Node.ELEMENT_NODE,new MutationObserver(function(r){for(var i=0,o=r;i<o.length;i+=1){for(var a=o[i],c=0,s=a.addedNodes;c<s.length;c+=1){var u=s[c];if(u.nodeType===t){if("childList"===a.type&&a.target.hasChildNodes(u))continue;e.textAdded(u)}else u.nodeType===n&&e.elementAdded(u)}for(var f=0,l=a.removedNodes;f<l.length;f+=1){var p=l[f];p.nodeType===t?e.textRemoved(p):p.nodeType===n&&e.elementRemoved(p)}}})).observe(this.$el,{childList:!0,subtree:!0})},a.prototype.$on=function(e,t,n){void 0===n&&(n={}),this.$events.push(Object.assign({},{prop:e,fn:t},"type"in n?{type:n.type}:{},"node"in n?{node:n.node}:{})),n.immediate&&this.$emit(e)},a.prototype.$emit=function(e){var t=this;this.$events.filter(function(t){return!e||t.prop===e}).forEach(function(e){var n=e.prop?[t[e.prop]]:[];e.fn.apply(t,n)})},a.directive=t,a}();
