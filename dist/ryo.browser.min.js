var Ryo=function(){"use strict";function o(e,t){var n="[ryo"+(t?"":" error")+"] "+e;if(!t)throw new Error(n);console.warn(n)}function c(e){return e.replace(/-(.)/g,function(e,t){return/[a-z]/.test(t)?t.toUpperCase():t})}var u=[];function e(e,t){e=e.toLowerCase(),/^[a-z]+(?:-?\*)?$/.test(e)||o('invalid directive name "'+e+'"; only a-z and numbers, wildcard at end (could be seperated with a hyphen)');var n=new RegExp("^"+e.replace(/\*$/,"([a-z]+)")+"$"),i={name:e,expression:n,fn:t};u.push(i)}function i(e,t,n){for(var i=null,r=0,a=u.length;r<a;r++)if(u[r].expression.test(e)){i=u[r];break}null===i&&o('directive "'+e+'" not found');var s=function(e){var t,n,i=/((?: --(?:(?:[a-z]+-)*[a-z0-9]+)+)+)$/,r=e.replace(i,""),a=i.exec(e),s={};if(null!==(a=null===a?null:a[0])){var o=a.split(" --").filter(function(e){return!!e}).map(c);t=!0,n={},o.forEach(function(e){n[e]=t}),s=n}return{value:r,modifiers:s}}(n.getAttribute("r-"+e));i.fn.bind(t)(n,Object.assign({},s,{wildcard:e.match(i.expression)[1]}))}e("text",function(e,t){var n,i=t.value;i&&this.$_onChange(i,(n=e,function(e){var t;"string"==typeof e&&(e=(t=e,t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")).replace(/  /g,"&nbsp;&nbsp;").replace(/\n/g,"<br>")),n.innerHTML=e}),!0)}),e("model",function(n,i){var r=this;/^(?:INPUT|TEXTAREA)$/.test(n.tagName)||o('<input> or <textarea> required for "model" directive');var a=i.value,e=i.modifiers.lazy?"change":"keydown";n.addEventListener(e,function(){setTimeout(function(){var e=n.value,t="number"===n.type;t&&(e=Number(e)),i.modifiers.trim&&!t&&(e=e.trim()),e!==r.state[a]&&(r.state[a]=e)},0)}),this.$_onChange(a,function(e){n.value=e},!0)});var r=[];e("on*",function(e,u){var t,f=this,n=u.wildcard;t=n,0===r.length&&(r=Object.keys(window).filter(function(e){return/^on/.test(e)}).map(function(e){return e.replace(/^on/,"")})),r.includes(t)||o('event "'+u.value+'" is not a valid DOM event');var l=/^key(?:down|up|press)$/.test(n);e.addEventListener(n,function(e){u.modifiers.prevent&&e.preventDefault();var t,n=/(?:--|\+\+|[`"']|!)$/,i=u.value,r=i.match(n),a=null===r;if(r=null===r?null:r[0],l){var s={alt:(t=e).altKey,shift:t.shiftKey,ctrl:t.ctrlKey,meta:t.metaKey,key:t.which},o={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,capslock:20,esc:27,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46},c=Object.keys(u.modifiers).filter(function(e){return/^key/.test(e)}).map(function(e){return e.replace(/^key/,"").toLowerCase()})[0];if(/^[a-z]$/.test(c)&&(c=c.charCodeAt(0)-32),c in o&&(c=o[c]),c!=s.key||"shift"in u.modifiers!==s.shift||"alt"in u.modifiers!==s.alt||"meta"in u.modifiers!==s.meta||"ctrl"in u.modifiers!==s.ctrl)return}if(a)f.actions[i](e);else{if(i=i.replace(n,""),/'|"|`/.test(r))return f.state[i]="";switch(r){case"-":f.state[i]--;break;case"+":f.state[i]++;break;case"!":f.state[i]=!f.state[i]}}},{once:u.modifiers.once,passive:u.modifiers.passive,capture:u.modifiers.capture})}),e("class-*",function(t,e){var n=e.value,i=e.wildcard;this.$_onChange(n||i,function(e){t.classList[e?"add":"remove"](i)},!0)});var t=function(e,t){"string"==typeof e?this.el=document.querySelector(e):e instanceof HTMLElement?this.el=e:o("wrong selector or element: expected element or string, got "+String(e)),this.state=t.state||{},this.actions=t.actions||{},this.watchers=t.watchers||{},this.$_events={},this.$_init()};return t.prototype.$_initProxy=function(){var i=this;this.state=new Proxy(this.state,{get:function(e,t){if(t in e)return e[t];o('unknown state property "'+t+'"')},set:function(e,t,n){return t in e||o('unknown state property "'+t+'"'),e[t]=n,i.$_emit(t),!0}})},t.prototype.$_emit=function(t){var n=this;t in this.$_events||(this.$_events[t]=[]),this.$_events[t].forEach(function(e){e(n.state[t])})},t.prototype.$_onChange=function(e,t,n){var i=this.$_events[e];void 0===i&&(i=[]),i.push(t),this.$_events[e]=i,n&&this.$_emit(e)},t.prototype.$_init=function(){var t=this;Object.keys(this.actions).forEach(function(e){t.actions[e]=t.actions[e].bind(t)}),Object.keys(this.watchers).forEach(function(e){t.$_onChange(e,t.watchers[e].bind(t))}),this.$_initProxy(),this.el.querySelectorAll("*").forEach(this.$_execDirectives.bind(this)),this.$_observe()},t.prototype.$_execDirectives=function(t){var n=this;Array.from(t.attributes).map(function(e){return e.name}).filter(function(e){return/^r-/.test(e)}).forEach(function(e){i(e.replace(/^r-/,""),n,t)})},t.prototype.$_observe=function(){var t=this;new MutationObserver(function(e){e.forEach(function(e){Array.from(e.addedNodes).filter(function(e){return"#text"!==e.nodeName}).forEach(t.$_execDirectives.bind(t))})}).observe(this.el,{childList:!0})},t}();
