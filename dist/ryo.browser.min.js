var Ryo=function(){"use strict";function s(e,t){var n="[ryo"+(t?"":" error")+"] "+e;if(!t)throw new Error(n);console.warn(n)}function c(e){return e.replace(/-(.)/g,function(e,t){return/[a-z]/.test(t)?t.toUpperCase():t})}var u=[];function e(e,t){e=e.toLowerCase(),/^[a-z]+(?:-?\*)?$/.test(e)||s('invalid directive name "'+e+'"; only a-z and numbers, wildcard at end (could be seperated with a hyphen)');var n=new RegExp("^"+e.replace(/\*$/,"([a-z]+)")+"$"),r={name:e,expression:n,fn:t};u.push(r)}function r(e,t,n){for(var r=null,i=0,a=u.length;i<a;i++)if(u[i].expression.test(e)){r=u[i];break}null===r&&s('directive "'+e+'" not found');var o=function(e){var t,n,r=/((?: --(?:(?:[a-z]+-)*[a-z]+)+)+)$/,i=e.replace(r,""),a=r.exec(e),o={};if(null!==(a=null===a?null:a[0])){var s=a.split(" --").filter(function(e){return!!e}).map(c);t=!0,n={},s.forEach(function(e){n[e]=t}),o=n}return console.log(o),{value:i,modifiers:o}}(n.getAttribute("r-"+e));r.fn.bind(t)(n,Object.assign({},o,{wildcard:e.match(r.expression)[1]}))}e("text",function(e,t){var n,r=t.value;r&&this.$_onChange(r,(n=e,function(e){var t;"string"==typeof e&&(e=(t=e,t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")).replace(/  /g,"&nbsp;&nbsp;").replace(/\n/g,"<br>")),n.innerHTML=e}),!0)}),e("model",function(n,r){var i=this;/^(?:INPUT|TEXTAREA)$/.test(n.tagName)||s('<input> or <textarea> required for "model" directive');var a=r.value,e=r.modifiers.lazy?"change":"keydown";n.addEventListener(e,function(){setTimeout(function(){var e=n.value,t="number"===n.type;t&&(e=Number(e)),r.modifiers.trim&&!t&&(e=e.trim()),e!==i.state[a]&&(i.state[a]=e)},0)}),this.$_onChange(a,function(e){n.value=e},!0)});var n=[];e("on*",function(e,a){var t,o=this;t=a.wildcard,0===n.length&&(n=Object.keys(window).filter(function(e){return/^on/.test(e)}).map(function(e){return e.replace(/^on/,"")})),n.includes(t)||s('event "'+a.value+'" is not a valid DOM event'),e.addEventListener(a.wildcard,function(e){a.modifiers.prevent&&e.preventDefault();var t=/(?:--|\+\+|[`"']|!)$/,n=a.value,r=n.match(t),i=null===r;if(r=null===r?null:r[0],i)o.actions[n]();else{if(n=n.replace(t,""),/'|"|`/.test(r))return o.state[n]="";switch(r){case"-":o.state[n]--;break;case"+":o.state[n]++;break;case"!":o.state[n]=!o.state[n]}}},{once:a.modifiers.once,passive:a.modifiers.passive,capture:a.modifiers.capture})}),e("class-*",function(t,e){var n=e.value,r=e.wildcard;this.$_onChange(n||r,function(e){t.classList[e?"add":"remove"](r)},!0)});var t=function(e,t){"string"==typeof e?this.el=document.querySelector(e):e instanceof HTMLElement?this.el=e:s("wrong selector or element: expected element or string, got "+String(e)),this.state=t.state||{},this.actions=t.actions||{},this.watchers=t.watchers||{},this.$_events={},this.$_init()};return t.prototype.$_initStateProxy=function(){var r=this;this.state=new Proxy(this.state,{get:function(e,t){if(t in e)return e[t];s('unknown state property "'+t+'"')},set:function(e,t,n){return t in e||s('unknown state property "'+t+'"'),e[t]=n,r.$_emit(t),!0}})},t.prototype.$_emit=function(t){var n=this;t in this.$_events||(this.$_events[t]=[]),this.$_events[t].forEach(function(e){e(n.state[t])})},t.prototype.$_onChange=function(e,t,n){var r=this.$_events[e];void 0===r&&(r=[]),r.push(t),this.$_events[e]=r,n&&this.$_emit(e)},t.prototype.$_init=function(){var n=this;Object.keys(this.actions).forEach(function(e){n.actions[e]=n.actions[e].bind(n)}),Object.keys(this.watchers).forEach(function(e){n.$_onChange(e,n.watchers[e].bind(n))}),this.$_initStateProxy(),this.el.querySelectorAll("*").forEach(function(t){Array.from(t.attributes).map(function(e){return e.name}).filter(function(e){return/^r-/.test(e)}).forEach(function(e){r(e.replace(/^r-/,""),n,t)})})},t}();
