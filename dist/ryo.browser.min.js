var Ryo=function(){"use strict";function o(e,t){var n="[ryo"+(t?"":" error")+"] "+e;if(!t)throw new Error(n);console.warn(n)}var c=[];function e(e,t){e=e.toLowerCase(),/^[a-z]+(?:-?\*)?$/.test(e)||o('invalid directive name "'+e+'"; only a-z and numbers, wildcard at end (could be seperated with a hyphen)');var n=new RegExp("^"+e.replace(/\*$/,"([a-z]+)")+"$"),i={name:e,expression:n,fn:t};c.push(i)}e("text",function(e,t){var n,i=t.value;i&&this.$_onChange(i,(n=e,function(e){var t;"string"==typeof e&&(e=(t=e,t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")).replace(/  /g,"&nbsp;&nbsp;").replace(/\n/g,"<br>")),n.innerHTML=e}),!0)}),e("model",function(t,e){var n=this;/^(?:INPUT|TEXTAREA)$/.test(t.tagName)||o('<input> or <textarea> required for "model" directive');var i=e.value,r=e.modifiers.lazy?"change":"keydown";t.addEventListener(r,function(){setTimeout(function(){var e="number"===t.type?Number(t.value):t.value;e!==n.state[i]&&(n.state[i]=e)},0)}),this.$_onChange(i,function(e){t.value=e},!0)}),e("on*",function(e,a){var s=this;e.addEventListener(a.wildcard,function(e){a.modifiers.prevent&&e.preventDefault();var t=/(?:--|\+\+|[`"']|!)$/,n=a.value,i=n.match(t),r=null===i;if(i=null===i?null:i[0],r)s.actions[n]();else{if(n=n.replace(t,""),/'|"|`/.test(i))return s.state[n]="";switch(i){case"-":s.state[n]--;break;case"+":s.state[n]++;break;case"!":s.state[n]=!s.state[n]}}},{once:a.modifiers.once,passive:a.modifiers.passive,capture:a.modifiers.capture})}),e("class-*",function(t,e){var n=e.value,i=e.wildcard;this.$_onChange(n||i,function(e){t.classList[e?"add":"remove"](i)},!0)});var t=function(e,t){var n=this;"string"==typeof e?this.el=document.querySelector(e):e instanceof HTMLElement?this.el=e:o("wrong selector or element: expected element or string"),this.state=t.state||{},this.actions=t.actions||{},Object.keys(this.actions).forEach(function(e){n.actions[e]=n.actions[e].bind(n)}),this.$_events={},this.$_init()};return t.prototype.$_initStateProxy=function(){var i=this;this.state=new Proxy(this.state,{get:function(e,t){if(t in e)return e[t];o("property "+t+" does'nt exist in state.")},set:function(e,t,n){return t in e||o('property "'+t+"\" does'nt exist in state."),e[t]=n,i.$_emit(t),!0}})},t.prototype.$_emit=function(t){var n=this;t in this.$_events||(this.$_events[t]=[]),this.$_events[t].forEach(function(e){e(n.state[t])})},t.prototype.$_onChange=function(e,t,n){var i=this.$_events[e];void 0===i&&(i=[]),i.push(t),this.$_events[e]=i,n&&this.$_emit(e)},t.prototype.$_init=function(){var n=this;this.$_initStateProxy(),this.el.querySelectorAll("*").forEach(function(t){Array.from(t.attributes).map(function(e){return e.name}).filter(function(e){return/^r-/.test(e)}).forEach(function(e){!function(e,t,n){for(var i=null,r=0,a=c.length;r<a;r++)if(c[r].expression.test(e)){i=c[r];break}null===i&&o('directive "'+e+'" not found');var s=function(e){var t,n,i=/((?: --[a-z]+)+)$/,r=e.replace(i,""),a=i.exec(e),s={};if(null!==(a=null===a?null:a[0])){var o=a.split(" --").filter(function(e){return!!e});t=!0,n={},o.forEach(function(e){n[e]=t}),s=n}return{value:r,modifiers:s}}(n.getAttribute("r-"+e));i.fn.bind(t)(n,Object.assign({},s,{wildcard:e.match(i.expression)[1]}))}(e.replace(/^r-/,""),n,t)})})},t}();
