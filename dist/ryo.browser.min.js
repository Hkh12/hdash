var Ryo=function(){"use strict";function u(t,e){var n="[ryo"+(e?"":" error")+"] "+t;if(!e)throw new Error(n);console.warn(n)}var f=[];function t(t,e){t=t.toLowerCase(),/^[a-z]+(?:-?\*)?$/.test(t)||u('invalid directive name "'+t+'"');var n=new RegExp(t.replace(/\*$/,"([a-z]+)")+"$"),i={name:t,expression:n,fn:e};f.push(i)}t("text",function(e,t){var i=this,n=t.value,r=function(t,e){var n;"string"==typeof e&&(e=(n=e,n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")).replace(/ /g,"&nbsp;")),t.innerHTML=e};if(n)this.$_onChange(n,function(t){r(e,t)},!0);else{var o=/\{\{([a-z0-9_$]+)\}\}/gi;Array.from(e.querySelectorAll("*")).filter(function(t){return o.test(t.innerHTML)}).forEach(function(n){n.innerHTML.replace(o,function(t,e){i.$_onChange(e,function(t){r(n,t)},!0)})})}}),t("sync",function(e,t){var n=this;/^(?:INPUT|TAGNAME)$/.test(e.tagName)||error('<input> or <textarea> required for "sync" directive');var i=t.value;e.addEventListener("keydown",function(){setTimeout(function(){var t="number"===e.type?Number(e.value):e.value;t!==n.state[i]&&(n.state[i]=t)},0)}),this.$_onChange(i,function(t){e.value=t},!0)}),t("on*",function(t,e,n){var i,r,o,a,s,c=this;r=/^([a-z0-9$_]+)((?: ?#[a-z0-9]+)+)?$/i.exec((i=e).value),o=r[1],a=r[2],s={},void 0!==a&&a.split("#").filter(function(t){return!!t.trim()}).map(function(t){return t.trim()}).forEach(function(t){s[t]=!0}),e={name:i.name,value:o,originalValue:i.value,modifiers:s},console.log(e),t.addEventListener(n,function(t){e.modifiers.prevent&&t.preventDefault(),c.actions[e.value]()},{once:e.modifiers.once,passive:e.modifiers.passive,capture:e.modifiers.capture})}),t("class-*",function(e,t,n){var i=t.value||n;this.$_onChange(i,function(t){e.classList[t?"add":"remove"](n)},!0)});var e=function(t,e){var n=this;"string"==typeof t?this.el=document.querySelector(t):t instanceof HTMLElement?this.el=t:u("wrong selector or element: expected element or string"),this.state=e.state||{},this.actions=e.actions||{},Object.keys(this.actions).forEach(function(t){n.actions[t]=n.actions[t].bind(n)}),this.$_events={},this.$_init()};return e.prototype.$_initStateProxy=function(){var i=this;this.state=new Proxy(this.state,{get:function(t,e){if(e in t)return t[e];u("property "+e+" does'nt exist in state.")},set:function(t,e,n){return e in t||u('property "'+e+"\" does'nt exist in state."),t[e]=n,i.$_emit(e),!0}})},e.prototype.$_emit=function(e){var n=this;e in this.$_events||(this.$_events[e]=[]),this.$_events[e].forEach(function(t){t(n.state[e])})},e.prototype.$_onChange=function(t,e,n){var i=this.$_events[t];void 0===i&&(i=[]),i.push(e),this.$_events[t]=i,n&&this.$_emit(t)},e.prototype.$_init=function(){var n=this;this.$_initStateProxy(),this.el.querySelectorAll("*").forEach(function(e){Array.from(e.attributes).map(function(t){return t.name}).filter(function(t){return/^r-/.test(t)}).forEach(function(t){!function(t,e,n){console.log(t);for(var i=null,r=0,o=f.length;r<o;r++)if(f[r].expression.test(t)){i=f[r];break}null===i&&u('directive "'+t+'" not found');var a=t.match(i.expression),s=(a.length,a[1]),c=n.attributes.getNamedItem("r-"+t);i.fn.bind(e)(n,c,s)}(t.replace(/^r-/,""),n,e)})})},e}();
