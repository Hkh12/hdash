var Ryo=function(){"use strict";function o(t,e){var n="[ryo"+(e?"":" error")+"] "+t;if(!e)throw new Error(n);console.warn(n)}var c=[];function t(t,e){t=t.toLowerCase(),/^[a-z]+(?:-?\*)?$/.test(t)||o('invalid directive name "'+t+'"; only a-z and numbers, wildcard at end (could be seperated with a hyphen)');var n=new RegExp("^"+t.replace(/\*$/,"([a-z]+)")+"$"),i={name:t,expression:n,fn:e};c.push(i)}t("text",function(t,e){var n,i=e.value;i&&this.$_onChange(i,(n=t,function(t){var e;"string"==typeof t&&(t=(e=t,e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")).replace(/  /g,"&nbsp;&nbsp;").replace(/\n/g,"<br>")),n.innerHTML=t}),!0)}),t("model",function(e,t){var n=this;/^(?:INPUT|TEXTAREA)$/.test(e.tagName)||o('<input> or <textarea> required for "model" directive');var i=t.value,r=t.modifiers.lazy?"change":"keydown";e.addEventListener(r,function(){setTimeout(function(){var t="number"===e.type?Number(e.value):e.value;t!==n.state[i]&&(n.state[i]=t)},0)}),this.$_onChange(i,function(t){e.value=t},!0)}),t("on*",function(t,a){var s=this;t.addEventListener(a.wildcard,function(t){a.modifiers.prevent&&t.preventDefault();var e=/(?:--|\+\+|[`"']|!)$/,n=a.value,i=n.match(e),r=null===i;if(i=null===i?null:i[0],r)s.actions[n]();else{if(n=n.replace(e,""),/'|"|`/.test(i))return s.state[n]="";switch(i){case"-":s.state[n]--;break;case"+":s.state[n]++;break;case"!":s.state[n]=!s.state[n]}}},{once:a.modifiers.once,passive:a.modifiers.passive,capture:a.modifiers.capture})}),t("class-*",function(e,t){var n=t.value,i=t.wildcard;this.$_onChange(n||i,function(t){e.classList[t?"add":"remove"](i)},!0)});var e=function(t,e){"string"==typeof t?this.el=document.querySelector(t):t instanceof HTMLElement?this.el=t:o("wrong selector or element: expected element or string, got "+String(t)),this.state=e.state||{},this.actions=e.actions||{},this.watchers=e.watchers||{},this.$_events={},this.$_init()};return e.prototype.$_initStateProxy=function(){var i=this;this.state=new Proxy(this.state,{get:function(t,e){if(e in t)return t[e];o('unknown state property "'+e+'"')},set:function(t,e,n){return e in t||o('unknown state property "'+e+'"'),t[e]=n,i.$_emit(e),!0}})},e.prototype.$_emit=function(e){var n=this;e in this.$_events||(this.$_events[e]=[]),this.$_events[e].forEach(function(t){t(n.state[e])})},e.prototype.$_onChange=function(t,e,n){var i=this.$_events[t];void 0===i&&(i=[]),i.push(e),this.$_events[t]=i,n&&this.$_emit(t)},e.prototype.$_init=function(){var n=this;Object.keys(this.actions).forEach(function(t){n.actions[t]=n.actions[t].bind(n)}),Object.keys(this.watchers).forEach(function(t){n.$_onChange(t,n.watchers[t].bind(n))}),this.$_initStateProxy(),this.el.querySelectorAll("*").forEach(function(e){Array.from(e.attributes).map(function(t){return t.name}).filter(function(t){return/^r-/.test(t)}).forEach(function(t){!function(t,e,n){for(var i=null,r=0,a=c.length;r<a;r++)if(c[r].expression.test(t)){i=c[r];break}null===i&&o('directive "'+t+'" not found');var s=function(t){var e,n,i=/((?: --[a-z]+)+)$/,r=t.replace(i,""),a=i.exec(t),s={};if(null!==(a=null===a?null:a[0])){var o=a.split(" --").filter(function(t){return!!t});e=!0,n={},o.forEach(function(t){n[t]=e}),s=n}return{value:r,modifiers:s}}(n.getAttribute("r-"+t));i.fn.bind(e)(n,Object.assign({},s,{wildcard:t.match(i.expression)[1]}))}(t.replace(/^r-/,""),n,e)})})},e}();
