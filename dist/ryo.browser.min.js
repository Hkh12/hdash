var Ryo=function(){"use strict";function u(t,e){var n="[ryo"+(e?"":" error")+"] "+t;if(!e)throw new Error(n);console.warn(n)}var f=[];function t(t,e){t=t.toLowerCase(),/^[a-z]+(?:-?\*)?$/.test(t)||u('invalid directive name "'+t+'"');var n=new RegExp(t.replace(/\*$/,"([a-z]+)")+"$"),i={name:t,expression:n,fn:e};f.push(i)}t("text",function(t,e){var n,i=e.value;i&&this.$_onChange(i,(n=t,function(t){var e;"string"==typeof t&&(t=(e=t,e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")).replace(/  /g,"&nbsp;&nbsp;").replace(/\n/g,"<br>")),n.innerHTML=t}),!0)}),t("sync",function(e,t){var n=this;/^(?:INPUT|TEXTAREA)$/.test(e.tagName)||u('<input> or <textarea> required for "sync" directive');var i=t.value;e.addEventListener("keydown",function(){setTimeout(function(){var t="number"===e.type?Number(e.value):e.value;t!==n.state[i]&&(n.state[i]=t)},0)}),this.$_onChange(i,function(t){e.value=t},!0)}),t("on*",function(t,e,n){var i=this,r=/^([a-zA-Z0-9$_]+)(\+\+|--|['"`]|!)?(?:  \| ((?: [a-z]+)+))?$/.exec(e.value),s=r[1],a=r[2],o=r[3],c={},u=void 0===a;"string"==typeof o&&o.trimLeft().split(" ").forEach(function(t){c[o]=!0}),t.addEventListener(n,function(t){if(c.prevent&&t.preventDefault(),u)i.actions[s]();else{if(/'|"|`/.test(a))return i.state[s]="";switch(a){case"--":i.state[s]--;break;case"++":i.state[s]++;break;case"!":i.state[s]=!i.state[s]}}},{once:c.once,passive:c.passive,capture:c.capture})}),t("class-*",function(e,t,n){var i=t.value||n;this.$_onChange(i,function(t){e.classList[t?"add":"remove"](n)},!0)});var e=function(t,e){var n=this;"string"==typeof t?this.el=document.querySelector(t):t instanceof HTMLElement?this.el=t:u("wrong selector or element: expected element or string"),this.state=e.state||{},this.actions=e.actions||{},Object.keys(this.actions).forEach(function(t){n.actions[t]=n.actions[t].bind(n)}),this.$_events={},this.$_init()};return e.prototype.$_initStateProxy=function(){var i=this;this.state=new Proxy(this.state,{get:function(t,e){if(e in t)return t[e];u("property "+e+" does'nt exist in state.")},set:function(t,e,n){return e in t||u('property "'+e+"\" does'nt exist in state."),t[e]=n,i.$_emit(e),!0}})},e.prototype.$_emit=function(e){var n=this;e in this.$_events||(this.$_events[e]=[]),this.$_events[e].forEach(function(t){t(n.state[e])})},e.prototype.$_onChange=function(t,e,n){var i=this.$_events[t];void 0===i&&(i=[]),i.push(e),this.$_events[t]=i,n&&this.$_emit(t)},e.prototype.$_init=function(){var n=this;this.$_initStateProxy(),this.el.querySelectorAll("*").forEach(function(e){Array.from(e.attributes).map(function(t){return t.name}).filter(function(t){return/^r-/.test(t)}).forEach(function(t){!function(t,e,n){for(var i=null,r=0,s=f.length;r<s;r++)if(f[r].expression.test(t)){i=f[r];break}null===i&&u('directive "'+t+'" not found');var a=t.match(i.expression),o=(a.length,a[1]),c=n.attributes.getNamedItem("r-"+t);i.fn.bind(e)(n,c,o)}(t.replace(/^r-/,""),n,e)})})},e}();
