"use strict";function error(e,t){var r="[ryo"+(t?"":" error")+"] "+e;if(!t)throw new Error(r);console.warn(r)}function record(e,t){var r={};return e.forEach(function(e){r[e]=t}),r}function parse(e){var t=/((?: --[a-z]+)+)$/,r=e.replace(t,""),n=t.exec(e),i={};null!==(n=null===n?null:n[0])&&(i=record(n.split(" --").filter(function(e){return!!e}),!0));return{value:r,modifiers:i}}var alld=[];function register(e,t){e=e.toLowerCase(),/^[a-z]+(?:-?\*)?$/.test(e)||error('invalid directive name "'+e+'"');var r=new RegExp(e.replace(/\*$/,"([a-z]+)")+"$"),n={name:e,expression:r,fn:t};alld.push(n)}function exec(e,t,r){for(var n=null,i=0,o=alld.length;i<o;i++)if(alld[i].expression.test(e)){n=alld[i];break}null===n&&error('directive "'+e+'" not found');var s=parse(r.getAttribute("r-"+e));n.fn.bind(t)(r,Object.assign({},s,{wildcard:e.match(n.expression)[1]}))}function sanitizeHTML(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}register("text",function(e,t){var r,n=t.value;n&&this.$_onChange(n,(r=e,function(e){"string"==typeof e&&(e=sanitizeHTML(e).replace(/  /g,"&nbsp;&nbsp;").replace(/\n/g,"<br>")),r.innerHTML=e}),!0)}),register("model",function(t,e){var r=this;/^(?:INPUT|TEXTAREA)$/.test(t.tagName)||error('<input> or <textarea> required for "model" directive');var n=e.value;t.addEventListener("keydown",function(){setTimeout(function(){var e="number"===t.type?Number(t.value):t.value;e!==r.state[n]&&(r.state[n]=e)},0)}),this.$_onChange(n,function(e){t.value=e},!0)}),register("on*",function(e,o){var s=this;e.addEventListener(o.wildcard,function(e){o.modifiers.prevent&&e.preventDefault();var t=/(?:--|\+\+|[`"']|!)$/,r=o.value,n=r.match(t),i=null===n;if(n=null===n?null:n[0],i)s.actions[r]();else{if(r=r.replace(t,""),/'|"|`/.test(n))return s.state[r]="";switch(n){case"-":s.state[r]--;break;case"+":s.state[r]++;break;case"!":s.state[r]=!s.state[r]}}},{once:o.modifiers.once,passive:o.modifiers.passive,capture:o.modifiers.capture})}),register("class-*",function(t,e,r){var n=e.value||r;this.$_onChange(n,function(e){t.classList[e?"add":"remove"](r)},!0)},!0);var Ryo=function(e,t){var r=this;"string"==typeof e?this.el=document.querySelector(e):e instanceof HTMLElement?this.el=e:error("wrong selector or element: expected element or string"),this.state=t.state||{},this.actions=t.actions||{},Object.keys(this.actions).forEach(function(e){r.actions[e]=r.actions[e].bind(r)}),this.$_events={},this.$_init()};Ryo.prototype.$_initStateProxy=function(){var n=this;this.state=new Proxy(this.state,{get:function(e,t){if(t in e)return e[t];error("property "+t+" does'nt exist in state.")},set:function(e,t,r){return t in e||error('property "'+t+"\" does'nt exist in state."),e[t]=r,n.$_emit(t),!0}})},Ryo.prototype.$_emit=function(t){var r=this;t in this.$_events||(this.$_events[t]=[]),this.$_events[t].forEach(function(e){e(r.state[t])})},Ryo.prototype.$_onChange=function(e,t,r){var n=this.$_events[e];void 0===n&&(n=[]),n.push(t),this.$_events[e]=n,r&&this.$_emit(e)},Ryo.prototype.$_init=function(){var r=this;this.$_initStateProxy(),this.el.querySelectorAll("*").forEach(function(t){Array.from(t.attributes).map(function(e){return e.name}).filter(function(e){return/^r-/.test(e)}).forEach(function(e){exec(e.replace(/^r-/,""),r,t)})})},module.exports=Ryo;
